<html><head><title>Test</title>
</head>
<body>
	<div id="wiki-content">
		<h1>Wiki</h1>
		Loading...
	</div>
<script src="https://github.com/coreyti/showdown/raw/master/compressed/showdown.js"></script>
<script src="http://github.com/cowboy/jquery-bbq/raw/v1.2.1/jquery.ba-bbq.min.js"></script>
<!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.8.12/jquery-ui.min.js"></script>-->
<script src="http://code.jquery.com/jquery-latest.js"></script>
<script type="text/javascript">
    var converter = new Showdown.converter();
    function escapeWikiAnchors(text) {
        text = text.replace(/\[\[([^|\]]+)\|([^\]]+)\]\]/g, function(wholeMatch, m1, m2) {
            return "[" + m1 + "](" + (!(/\/\//).test(m2) ? '#' : '') + m2 + ")";
        });

        text = text.replace(/\[\[([^\]]+)\]\]/g, function(wholeMatch, m1) {
            return "[" + m1 + "](#" + m1.split(' ').join('-') + ")";
        });

        return text;
    }

	function wikify(userName, repoName, pageName, extension) {
		var pageName = pageName || 'Home',
			wikiUrl = ['https://raw.github.com/wiki/', userName, '/', repoName, '/'].join(''),
			url = [
			"http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20data.headers%20where%20url%3D%22",
			wikiUrl, pageName, extension,
			"%22&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys"].join('');
		document.write(url);	
        var jqxhr = $.getJSON(url,
		    function(data) {
				var content;
                
				if (data.query.results.resources.redirect) {
                    content = "This is a non-existent page";
                    pageName = "Not Found";
                } else {
                    content = converter.makeHtml(escapeWikiAnchors(data.query.results.resources.content));
                }
         		content = $('#wiki-content').html(content);
                if (content.find('h1').length < 1) {
                    content.prepend('<h1>' + pageName.replace('-',' ') + '</h1>');
                }        
			})
        .error(function() { alert("error"); })
	}
	
	wikify('ninject', 'ninject', 'Changes-in-Ninject-3', '.md');

</script>
</body></html>